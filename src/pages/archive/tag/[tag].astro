---
import ArchivePanel from "@components/ArchivePanel.astro";
import MainGridLayout from "@layouts/MainGridLayout.astro";
import { getSortedPosts } from "@utils/content-utils";
import { t, getCurrentLocale } from "../../../i18n";

const locale = getCurrentLocale();

export async function getStaticPaths() {
	const localePosts = await getSortedPosts("zh-CN");

	const allTags = localePosts.reduce<Set<string>>((acc, post) => {
		post.data.tags.forEach((tag) => acc.add(tag));
		return acc;
	}, new Set());

	const allTagsArray = Array.from(allTags);

	return allTagsArray.map((tag) => ({
		params: {
			tag,
		},
	}));
}

const tag = Astro.params.tag as string;
---

<MainGridLayout title={`${tag} - ${t("common.tags", locale)}`} description={`${t("archive.title", locale)} - ${tag}`} hideSidebar={true}>
	<ArchivePanel tags={[tag]} locale={locale}></ArchivePanel>
</MainGridLayout>
